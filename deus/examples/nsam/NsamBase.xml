<?xml version="1.0" encoding="UTF-8"?>
<aut:automator
	xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->


	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.nsam.NsamBirthSchedulerListener" >
	 	<aut:events><!-- events to be scheduled on created node -->
		    <aut:reference id="connection" />
		</aut:events>
	</aut:event>
	

	<aut:event id="connection" handler="it.unipr.ce.dsg.deus.p2p.event.MultipleRandomConnectionsEvent" oneShot="true" >
		<aut:params>
			<aut:param name="isBidirectional" value="true" />
			<aut:param name="numInitialConnections" value="3" />
		</aut:params>
	</aut:event>
	

  <aut:event id ="updateNodeProperty" handler="it.unipr.ce.dsg.deus.example.nsam.UpdateNodePropertyEvent"> 
	<aut:logger level="FINE" />
	</aut:event>	
	
	<aut:event id ="discoveredListCheck" handler="it.unipr.ce.dsg.deus.example.nsam.NsamPeriodicDiscoveredListCheck"> 
	<aut:logger level="FINE" />
	</aut:event>	
	
	<aut:event id="death" handler="it.unipr.ce.dsg.deus.impl.event.DeathEvent" oneShot="true" />
	 
	<aut:event id="logPopulationSize" handler="it.unipr.ce.dsg.deus.impl.event.LogPopulationSizeEvent" />

	<aut:event id="logNodeDegree" handler="it.unipr.ce.dsg.deus.p2p.event.LogNodeDegreeEvent" />
	
	<aut:event id="logNsamPeerStats" handler="it.unipr.ce.dsg.deus.example.nsam.LogNsamPeerStatsEvent" />
	
	<aut:event id="logNsamServicesDistribution" handler="it.unipr.ce.dsg.deus.example.nsam.LogNsamServicesDistributionEvent" oneShot="true"/>
	
	
	<!-- *** NODE SPECIES *** -->
	

<!-- questi sono i tre tipi di nodi presenti nella rete, tutti riferiti ad uno stesso handler  -->

	<aut:node id="pcNode" handler="it.unipr.ce.dsg.deus.example.nsam.NsamPeer">
			<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="adsl" />
		<!-- 	<aut:param name="bandwidth" value=""/>   -->
			<aut:param name="qualityLevel" value="4" />    
			<aut:param name="maxServiceNum" value="10" />  
			<aut:param name="maxServiceInputNum" value="5" />  <!-- num di in e out per i servizi -->
			<aut:param name="maxServiceOutputNum" value="5" />
			<aut:param name="serviceInputRange" value="20" />
			<aut:param name="serviceOutputRange" value="20" /> 
			<aut:param name="isRandomInit" value="true" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
				    <aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="10" />
				</aut:params>	
			</aut:resource>
		</aut:resources>
	</aut:node>

	<aut:node id="mobileNode" handler="it.unipr.ce.dsg.deus.example.nsam.NsamPeer">
			<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="80" />
			<aut:param name="connectionType" value="wifi" />
	<!--  	<aut:param name="bandwidth" value=""/>  -->	
			<aut:param name="qualityLevel" value="3" />    
			<aut:param name="maxServiceNum" value="7" /> 
			<aut:param name="maxServiceInputNum" value="5" />
			<aut:param name="maxServiceOutputNum" value="5" />
			<aut:param name="serviceInputRange" value="20" />
			<aut:param name="serviceOutputRange" value="20" /> 
			<aut:param name="isRandomInit" value="true" />
		</aut:params>
		
		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					 <aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="5" />
				</aut:params>	
			</aut:resource>
		</aut:resources>
	</aut:node>
	
	<aut:node id="mobile3GNode" handler="it.unipr.ce.dsg.deus.example.nsam.NsamPeer">
			<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="60" />
			<aut:param name="connectionType" value="3g" />
	<!-- 	<aut:param name="bandwidth" value=""/>   -->	
			<aut:param name="qualityLevel" value="3" />    
			<aut:param name="maxServiceNum" value="5" />  
			<aut:param name="isRandomInit" value="true" />
		</aut:params>
		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					 <aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="2" />
				</aut:params>	
			</aut:resource>
		</aut:resources>
	</aut:node>


	<!-- *** PROCESSES *** -->

	<!-- with 1/lambda = 1000 and 1/lambda' = 1000000, we have E[N] = lambda/lambda' = 1000 -->

<!-- evento di nascita dei nodi, per ora hanno tutti lo stesso processo, poi differenzio come nell'esempio streaming -->

<aut:process id="rectpulseperiodic" handler="it.unipr.ce.dsg.deus.impl.process.RectangularPulsePeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10" />
			<aut:param name="startVtThreshold" value="0" />
			<aut:param name="stopVtThreshold" value="10000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />
			<aut:reference id="mobileNode" />
			<aut:reference id="mobile3GNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />
		</aut:events>
	</aut:process>

<!--evento di connessione dei nodi, sempre tutti uguali -->

<aut:process id="poisson2" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="5" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />
			<aut:reference id="mobileNode" />
			<aut:reference id="mobile3GNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="connection" />
		</aut:events>
	</aut:process>


	
<!-- questo processo raccoglie le statistiche -->	
	<aut:process id="periodic2" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="100000" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="logPopulationSize" />
			<aut:reference id="logNodeDegree" /> 
			<aut:reference id="logNsamServicesDistribution" />
		</aut:events>
	</aut:process>
	
		<aut:process id="periodic" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="100000" /> 
		</aut:params>
		<aut:events> 
		<aut:reference id="logNsamServicesDistribution" /> 
		</aut:events>
	</aut:process>



	<aut:process id="periodicNodeUpdate" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="200000" /> 
		</aut:params>
		<aut:events>
			<aut:reference id="updateNodeProperty" />  
		</aut:events>
	</aut:process>


	<!-- *** SIMULATION ***   -->

	<aut:engine maxvt="100001" seed="123456789"> 
		<aut:logger level="INFO" />
		<aut:processes>
			<aut:reference id="rectpulseperiodic" /> 
			<aut:reference id="periodic2" />
		</aut:processes>
	</aut:engine>


</aut:automator>
