<?xml version="1.0" encoding="UTF-8"?>
<aut:automator xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->

    <!-- SERVER -->
	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		oneShot="true"></aut:event>

    <!-- PEER -->
	<aut:event id="birth2" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		schedulerListener="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingBirthSchedulerListener">
		<aut:events><!-- events to be scheduled on created node -->
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>
	</aut:event>


  <!-- PEER -->
	<aut:event id="birth3" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		schedulerListener="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingBirthSchedulerListener">
		<aut:events><!-- events to be scheduled on created node -->
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>

	</aut:event>

	 <!-- PEER -->
	<aut:event id="birth4" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		schedulerListener="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingBirthSchedulerListener">
		<aut:events>
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>
	</aut:event>
	
	
	<aut:event id="connection"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingConnectionEvent"
		oneShot="true">
		<aut:logger level="FINE" />

	</aut:event>



	<aut:event id="discovery"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingDiscoveryEvent"
		oneShot="true">

		<aut:logger level="FINE" />
	</aut:event>
	
	<aut:event id="connectionChange" handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessStreamingConnectionChange">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="2gMaxAcceptedConnection" value="2" />
			<aut:param name="2gUploadSpeed" value="0.0025" />
			<aut:param name="3gMaxAcceptedConnection" value="4" />
			<aut:param name="3gUploadSpeed" value="0.05" />
		</aut:params>
	</aut:event>

	<aut:event id="newvideores"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingServerNewVideoResourceEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updateNodeVideoRes"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingPeerNewVideoResourceEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="playVideo"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingPlayVideoEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updatelist"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingUpdateParentsEvent">
		<aut:logger level="FINE" />
	</aut:event>
	
	<aut:event id="sendvideochunk"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingSendVideoChunkEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updateVideoBuffer" 
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingUpdateVideoBufferEvent" >
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updateBattery" 
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingUpdateBattery" >
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="disconnection"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingDisconnectionEvent">

		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="death" handler="it.unipr.ce.dsg.deus.impl.event.DeathEvent"
		oneShot="true" />


	<aut:event id="logNodeVideoData"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.LogFitnessCoolStreamingPeerVideoDataStatsEvent">
		<aut:logger level="INFO" />
	</aut:event>

	<aut:event id="logNodeConnectionStat"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.LogFitnessCoolStreamingPeerConnectionStatsEvent">
		<aut:logger level="INFO" />
		<aut:params>
			<aut:param name="filename" value="simulazione[25%pc_0.3][75%high_0.8].dat" />
		</aut:params>
	</aut:event>

	<aut:event id="graphData"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.LogFitnessCoolStreamingNetGraphEvent">
		<aut:logger level="INFO" />
	</aut:event>


	<!-- *** NODE SPECIES *** -->

	<aut:node id="serverNode"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingServerPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="chunkSize" value="50" />  <!-- 20 Kbyte -->
			<aut:param name="uploadSpeed" value="10.0" />
			<aut:param name="downloadSpeed" value="20.0" />
			<aut:param name="k_value" value="4" />
			<aut:param name="isp" value="3" />
			<aut:param name="city" value="0" />			
			<!--
			ISP 0 = TISCALI
			ISP 1 = FASTWEB
			ISP 2 = GARR
			-->
		</aut:params>
		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="200" />					
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>

	<aut:node id="pcNode"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="3g" />
			<aut:param name="uploadSpeed" value="0.05" />
			<aut:param name="downloadSpeed" value="0.4" />
			<aut:param name="videoResourceBufferLimit" value="10" />
			<aut:param name="incentiveBased" value="false" />
			<aut:param name="fitnessBased" value="false" />
			<aut:param name="k_value" value="4" />
			<aut:param name="maxPartnersNumber" value="4" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="20" />
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>
	
	
	<aut:node id="pcNodeHigh"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="wifi" />
			<aut:param name="uploadSpeed" value="0.1" />
			<aut:param name="downloadSpeed" value="2.0" />
			<aut:param name="videoResourceBufferLimit" value="10" />
			<aut:param name="incentiveBased" value="false" />
			<aut:param name="fitnessBased" value="false" />
			<aut:param name="k_value" value="4" />
			<aut:param name="maxPartnersNumber" value="10" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="10" />
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>
	
	
	<aut:node id="superNode"
		handler="it.unipr.ce.dsg.deus.example.FitnessCoolStreaming.FitnessCoolStreamingPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="adsl" />
			<aut:param name="uploadSpeed" value="0.3" />
			<aut:param name="downloadSpeed" value="4.0" />
			<aut:param name="videoResourceBufferLimit" value="10" />
			<aut:param name="incentiveBased" value="false" />
			<aut:param name="fitnessBased" value="false" />
			<aut:param name="k_value" value="4" />
			<aut:param name="maxPartnersNumber" value="20" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="20" />
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>

	<!-- *** PROCESSES *** -->

	<aut:process id="serverPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="serverNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />
		</aut:events>
	</aut:process>

	<!-- 9 (0.9)/ 6 (0.3)/ 5 (0.2)/ 9(0.6)-->
	<aut:process id="twospeedspoissonPcNode"
		handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPoissonProcess">
		<aut:params>
			<aut:param name="firstMeanArrival" value="10" />
			<aut:param name="secondMeanArrival" value="50000" />
			<aut:param name="vtThreshold" value="5000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />			
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth2" />
		</aut:events>
	</aut:process>
	
	<!-- 17 (0.9)/ 40 (0.3) / 100000000 (0.2)/ 14 (0.6)-->
	<aut:process id="twospeedspoissonPcNodeHigh"
		handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPoissonProcess">
		<aut:params>
			<aut:param name="firstMeanArrival" value="80" />
			<aut:param name="secondMeanArrival" value="50000" />
			<aut:param name="vtThreshold" value="5000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNodeHigh" />			
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth3" />
		</aut:events>
	</aut:process>
	
	<!-- 46 (0.9) / 500 (0.3)/ 100000000 (0.2)/ 90 (0.6)-->
	<aut:process id="twospeedspoissonSuperNode"
		handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPoissonProcess">
		<aut:params>
			<aut:param name="firstMeanArrival" value="90" />
			<aut:param name="secondMeanArrival" value="50000" />
			<aut:param name="vtThreshold" value="5000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="superNode" />			
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth4" />
		</aut:events>
	</aut:process>
	
	<aut:process id="videoPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="20" /> <!--5-->
		</aut:params>
		<aut:events>
			<aut:reference id="newvideores" />
		</aut:events>
	</aut:process>
	
	<aut:process id="SendChunk" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="1" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />
			<aut:reference id="pcNodeHigh" />
			<aut:reference id="serverNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="sendvideochunk" />
		</aut:events>
	</aut:process>

	<aut:process id="updateListPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="100" /> <!-- 50 -->
		</aut:params>
		<aut:events>
			<aut:reference id="updatelist" />
		</aut:events>
	</aut:process>

	<aut:process id="connectionPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />
			<aut:reference id="pcNodeHigh" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>
	</aut:process>


	<aut:process id="disconnection" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="1000" /> <!-- Prima 200  -->
		</aut:params>
		<aut:events>
			<aut:reference id="disconnection" />			
		</aut:events>
	</aut:process>


	<aut:process id="updateVideoBuffer" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="50" /> 
		</aut:params>
		<aut:events>
			<aut:reference id="updateVideoBuffer" /> 
		</aut:events>
	</aut:process>

	<aut:process id="updateBattery"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="300" />
		</aut:params>
		<aut:events>
			<aut:reference id="updateBattery" />
		</aut:events>
	</aut:process>

	<aut:process id="periodic"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="100" />
		</aut:params>
		<aut:events>
			<!-- <aut:reference id="logNodeVideoData" /> -->
			<aut:reference id="logNodeConnectionStat" />
		</aut:events>
	</aut:process>


	<aut:process id="periodicPlayVideo"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="100" /> <!--25-->
		</aut:params>
		<aut:events>
			<aut:reference id="playVideo" />
		</aut:events>
	</aut:process>

	<aut:process id="graph"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10000" />
		</aut:params>
		<aut:events>
			<aut:reference id="graphData" />
		</aut:events>
	</aut:process>
	
	<aut:process id="connectionChangePoisson" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="3000" />
		</aut:params>
		<aut:events>
			<aut:reference id="connectionChange" />
		</aut:events>
	</aut:process>

	<!-- *** SIMULATION *** -->

	<aut:engine maxvt="50001" seed="123456000">

		<aut:logger level="INFO" />
		<aut:processes>
			<aut:reference id="serverPoisson1" />
			<aut:reference id="twospeedspoissonPcNode" />
			<aut:reference id="twospeedspoissonPcNodeHigh" />
			<aut:reference id="twospeedspoissonSuperNode" />
			<aut:reference id="SendChunk" />
			<aut:reference id="videoPoisson1" />			
			<aut:reference id="periodic" />
			<aut:reference id="updateListPoisson1" />
			<aut:reference id="updateBattery" />			
			<aut:reference id="periodicPlayVideo" />
			<aut:reference id="disconnection" />
			<aut:reference id="updateVideoBuffer" />
			<aut:reference id="connectionChangePoisson" />
			<aut:reference id="graph" />
		</aut:processes>
	</aut:engine>

</aut:automator>
