<?xml version="1.0" encoding="UTF-8"?>
<aut:automator xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->

    <!-- SERVER -->
	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		oneShot="true"></aut:event>

    <!-- PEER -->
	<aut:event id="birth2" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		schedulerListener="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingBirthSchedulerListener">
		<aut:events><!-- events to be scheduled on created node -->
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>

	</aut:event>


  <!-- PEER -->
	<aut:event id="birth3" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		schedulerListener="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingBirthSchedulerListener">
		<aut:events><!-- events to be scheduled on created node -->
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>

	</aut:event>

	 <!-- PEER -->
	<aut:event id="birth4" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent"
		schedulerListener="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingBirthSchedulerListener">
		<aut:events>
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>
	</aut:event>
	
	
	<aut:event id="connection"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingConnectionEvent"
		oneShot="true">
		<aut:logger level="FINE" />

	</aut:event>



	<aut:event id="discovery"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingDiscoveryEvent"
		oneShot="true">

		<aut:logger level="FINE" />

	</aut:event>

	<aut:event id="newvideores"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingServerNewVideoResourceEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updateNodeVideoRes"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingPeerNewVideoResourceEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="playVideo"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingPlayVideoEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updatelist"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingUpdateParentsEvent">
		<aut:logger level="FINE" />
	</aut:event>
	
	<aut:event id="sendvideochunk"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingSendVideoChunkEvent">
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="updateVideoBuffer" 
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingUpdateVideoBufferEvent" >
		<aut:logger level="FINE" />
	</aut:event>

	<aut:event id="disconnection"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingDisconnectionEvent">

		<aut:logger level="FINE" />
	</aut:event>


	<aut:event id="death" handler="it.unipr.ce.dsg.deus.impl.event.DeathEvent"
		oneShot="true" />


	<aut:event id="logNodeVideoData"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.LogCoolStreamingPeerVideoDataStatsEvent">
		<aut:logger level="INFO" />
	</aut:event>

	<aut:event id="logNodeConnectionStat"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.LogCoolStreamingPeerConnectionStatsEvent">
		<aut:logger level="INFO" />
		<aut:params>
			<aut:param name="filename" value="simulazione[25%pc_0.3][75%high_0.8].dat" />
		</aut:params>
		
	</aut:event>

	<aut:event id="graphData"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.LogCoolStreamingNetGraphEvent">
		<aut:logger level="INFO" />
	</aut:event>

	<!-- *** NODE SPECIES *** -->

	<aut:node id="serverNode"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingServerPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="chunkSize" value="160" />  <!-- 20 Kbyte -->
			<aut:param name="uploadSpeed" value="10.0" />
			<aut:param name="downloadSpeed" value="20.0" />
			<aut:param name="k_value" value="4" />
			<aut:param name="isp" value="3" />
			<aut:param name="city" value="0" />			
			<!--
			ISP 0 = TISCALI
			ISP 1 = FASTWEB
			ISP 2 = GARR
			-->
		</aut:params>
		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="200" />					
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>

	<aut:node id="pcNode"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="adsl" />
			<aut:param name="uploadSpeed" value="0.256" />
			<aut:param name="downloadSpeed" value="4.0" />
			<aut:param name="videoResourceBufferLimit" value="10" />
			<aut:param name="incentiveBased" value="true" />
			<aut:param name="k_value" value="4" />
			<aut:param name="maxPartnersNumber" value="20" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="10" />
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>
	
	
	<aut:node id="pcNodeHigh"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="adslplus" />
			<aut:param name="uploadSpeed" value="0.8" />
			<aut:param name="downloadSpeed" value="7.0" />
			<aut:param name="videoResourceBufferLimit" value="10" />
			<aut:param name="incentiveBased" value="true" />
			<aut:param name="k_value" value="4" />
			<aut:param name="maxPartnersNumber" value="20" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="10" />
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>
	
	
	<aut:node id="superNode"
		handler="it.unipr.ce.dsg.deus.example.coolStreaming.CoolStreamingPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="battery" value="100" />
			<aut:param name="connectionType" value="superpeer" />
			<aut:param name="uploadSpeed" value="5.0" />
			<aut:param name="downloadSpeed" value="20.0" />
			<aut:param name="videoResourceBufferLimit" value="10" />
			<aut:param name="incentiveBased" value="true" />
			<aut:param name="k_value" value="4" />
			<aut:param name="maxPartnersNumber" value="20" />
		</aut:params>

		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="maxAcceptedConnection" />
					<aut:param name="amount" value="30" />
				</aut:params>
			</aut:resource>
		</aut:resources>
	</aut:node>

	<!-- *** PROCESSES *** -->

	<aut:process id="serverPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="serverNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />
		</aut:events>
	</aut:process>

	<!-- 9 (0.9)/ 6 (0.3)/ 5 (0.2)/ 9(0.6)-->
	<aut:process id="twospeedspoissonPcNode"
		handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPoissonProcess">
		<aut:params>
			<aut:param name="firstMeanArrival" value="9" />
			<aut:param name="secondMeanArrival" value="1000" />
			<aut:param name="vtThreshold" value="5000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />			
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth2" />
		</aut:events>
	</aut:process>
	
	<!-- 17 (0.9)/ 40 (0.3) / 100000000 (0.2)/ 14 (0.6)-->
	<aut:process id="twospeedspoissonPcNodeHigh"
		handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPoissonProcess">
		<aut:params>
			<aut:param name="firstMeanArrival" value="14" />
			<aut:param name="secondMeanArrival" value="1500" />
			<aut:param name="vtThreshold" value="5000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNodeHigh" />			
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth3" />
		</aut:events>
	</aut:process>
	
	<!-- 46 (0.9) / 500 (0.3)/ 100000000 (0.2)/ 90 (0.6)-->
	<aut:process id="twospeedspoissonSuperNode"
		handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPoissonProcess">
		<aut:params>
			<aut:param name="firstMeanArrival" value="90" />
			<aut:param name="secondMeanArrival" value="1500" />
			<aut:param name="vtThreshold" value="5000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="superNode" />			
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth4" />
		</aut:events>
	</aut:process>
	
	<aut:process id="videoPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="5" /> <!--5-->
		</aut:params>
		<aut:events>
			<aut:reference id="newvideores" />
		</aut:events>
	</aut:process>
	
	<aut:process id="SendChunk"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="1" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />
			<aut:reference id="pcNodeHigh" />
			<aut:reference id="serverNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="sendvideochunk" />
		</aut:events>
	</aut:process>
	
<!-- 
	<aut:process id="videoPeerUpdate"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="10" />
		</aut:params>
		<aut:events>
			<aut:reference id="updateNodeVideoRes" />
		</aut:events>
	</aut:process>
 -->

	<aut:process id="updateListPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="50" />
		</aut:params>
		<aut:events>
			<aut:reference id="updatelist" />
			
		</aut:events>
	</aut:process>

	<aut:process id="connectionPoisson1"
		handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="pcNode" />
			<aut:reference id="pcNodeHigh" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="connection" />
			<aut:reference id="discovery" />
		</aut:events>
	</aut:process>


	<aut:process id="disconnection" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="200" /> 
		</aut:params>
		<aut:events>
			<aut:reference id="disconnection" />			
		</aut:events>
	</aut:process>


	<aut:process id="updateVideoBuffer" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="50" /> 
		</aut:params>
		<aut:events>
			<aut:reference id="updateVideoBuffer" /> 
		</aut:events>
	</aut:process>

	<aut:process id="periodic"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="100" />
		</aut:params>
		<aut:events>
			<aut:reference id="logNodeVideoData" />
			<aut:reference id="logNodeConnectionStat" />
		</aut:events>
	</aut:process>


	<aut:process id="periodicPlayVideo"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="25" /> <!--25-->
		</aut:params>
		<aut:events>
			<aut:reference id="playVideo" />
		</aut:events>
	</aut:process>


	<aut:process id="graph"
		handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10000" />
		</aut:params>
		<aut:events>
			<aut:reference id="graphData" />
		</aut:events>
	</aut:process>

	<!-- *** SIMULATION *** -->

	<aut:engine maxvt="10001" seed="123456000">

		<aut:logger level="INFO" />
		<aut:processes>
			<aut:reference id="serverPoisson1" />
			<aut:reference id="twospeedspoissonPcNode" />
			<aut:reference id="twospeedspoissonPcNodeHigh" />
			<aut:reference id="twospeedspoissonSuperNode" />
			<aut:reference id="SendChunk" />
			<aut:reference id="videoPoisson1" />			
			<aut:reference id="periodic" />
			<aut:reference id="updateListPoisson1" />			
			<aut:reference id="periodicPlayVideo" />
			<aut:reference id="disconnection" />
			<aut:reference id="updateVideoBuffer" />
			<aut:reference id="graph" />

		</aut:processes>
	</aut:engine>

</aut:automator>
