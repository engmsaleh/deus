<?xml version="1.0" encoding="UTF-8"?>
<aut:automator
	xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->

	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadBirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.geokad.GeoKadBirthSchedulerListener" >
	 	<aut:events><!-- events to be scheduled on created node -->
		    <aut:reference id="join" />
		</aut:events>
	</aut:event>

	<aut:event id="join" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadJoinEvent" oneShot="true" />

	<aut:event id="discovery" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadNodeLookUpEvent" />

	<aut:event id="death" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadDeathEvent" oneShot="true"/>
	
	<aut:event id="disconnection" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadDisconnectionEvent" />

  <aut:event id="logNodesData" handler="it.unipr.ce.dsg.deus.example.geokad.LogGeoKadNodesStatsEvent" />
  
  <aut:event id="logNodeMap" handler="it.unipr.ce.dsg.deus.example.geokad.LogGeoKadNodeMapEvent" />

  <aut:event id="initialization" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadNetworkInitializeEvent" oneShot="true" />

	
	<!-- *** NODE SPECIES *** -->

	<aut:node id="geokadPeer" handler="it.unipr.ce.dsg.deus.example.geokad.GeoKadPeer">
		<aut:logger level="FINE" />
		<aut:params>
			<aut:param name="numOfKBuckets" value="10" />
			<aut:param name="resourcesNode" value="20" />
			<aut:param name="alpha" value="3" />
			<aut:param name="discoveryMaxWait" value="50.0" />
			<aut:param name="rayDistance" value="1.5" />
		</aut:params>
	</aut:node>


	<!-- *** PROCESSES *** -->
	

	<aut:process id="periodicBirth" handler="it.unipr.ce.dsg.deus.impl.process.RectangularPulsePeriodicProcess">
	  <aut:params>
			<aut:param name="period" value="1" />
			<aut:param name="startVtThreshold" value="1" />
			<aut:param name="stopVtThreshold" value="100" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />		
		</aut:events>
	</aut:process>
	
	<aut:process id="poissonJoin" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>
		<aut:events>
			<aut:reference id="join" />
		</aut:events>
	</aut:process>
		
	
	<aut:process id="periodicDiscovery" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="25" /> <!-- 50VT = 3 min --> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="discovery" />
		</aut:events>
	</aut:process>

<!-- 
	<aut:process id="periodicDiscovery" handler="it.unipr.ce.dsg.deus.impl.process.RectangularPulsePeriodicProcess">
	  <aut:params>
			<aut:param name="period" value="10" />
			<aut:param name="startVtThreshold" value="1030" />
			<aut:param name="stopVtThreshold" value="2030" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="discovery" />		
		</aut:events>
	</aut:process>
 -->
	
	<!-- ***cosi i nodi da disconnettere sono casuali *** -->
	
	<aut:process id="periodicDeath" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="70" /> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="death" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicDisconnection" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="700" /> 
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="disconnection" />
		</aut:events>
	</aut:process>

	<aut:process id="poissonInitialize" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="0" />
		</aut:params>		<aut:events>
			<aut:reference id="initialization" />
		</aut:events>
	</aut:process>

  <!-- Tipo 2 -->
<!--
	<aut:process id="periodicDeath" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="700" />
			<aut:param name="secondPeriodArrival" value="200" />
			<aut:param name="vtThreshold" value="1500" />	
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="death" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodicDisconnection" handler="it.unipr.ce.dsg.deus.impl.process.TwoSpeedsPeriodicProcess">
		<aut:params>
			<aut:param name="firstPeriodArrival" value="700" />
			<aut:param name="secondPeriodArrival" value="200" />
			<aut:param name="vtThreshold" value="1500" />	
		</aut:params>
		<aut:nodes>
			<aut:reference id="geokadPeer" />
		</aut:nodes>
		<aut:events>
		    <aut:reference id="disconnection" />
		</aut:events>
	</aut:process>

-->

  <aut:process id="periodicNodeLogging" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
    <aut:params> 
      <aut:param name="period" value="1000" />
    </aut:params>
    <aut:events>
      <aut:reference id="logNodesData" />
    </aut:events>
  </aut:process>


  <aut:process id="periodicNodeMapLogging" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
    <aut:params> 
      <aut:param name="period" value="100" />
    </aut:params>
    <aut:events>
      <aut:reference id="logNodeMap" />
    </aut:events>
  </aut:process>
		
		
		
	<!-- *** SIMULATION *** (10000=10h 100VT = 6 min )-->
	<aut:engine maxvt="100000" seed="1234567810" keyspacesize="200000"> 
		<aut:logger level="ALL" />
		<aut:processes>
		<aut:reference id="periodicBirth" />
       <!--<aut:reference id="poissonInitialize" /> -->
     	<!--<aut:reference id="periodicDiscovery" />   -->
	    <aut:reference id="periodicNodeLogging" />
	    <aut:reference id="periodicNodeMapLogging" />
		<!-- <aut:reference id="periodicDeath" />  --> 
		<!-- <aut:reference id="periodicDisconnection" />  --> 
		</aut:processes>
	</aut:engine>

</aut:automator>
