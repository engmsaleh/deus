<?xml version="1.0" encoding="UTF-8"?>
<aut:automator
	xmlns:aut="http://dsg.ce.unipr.it/software/deus/schema/automator"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://dsg.ce.unipr.it/software/deus/schema/automator ../../schema/automator.xsd ">


	<!-- *** EVENTS *** -->
	
	<aut:event id="birth" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.revol.RevolBirthSchedulerListener" >
	 	<aut:events><!-- events to be scheduled on created node -->
		    <aut:reference id="connection" /> 
		</aut:events>
	</aut:event>
	
    <aut:event id="birth2" handler="it.unipr.ce.dsg.deus.impl.event.BirthEvent" 
		schedulerListener="it.unipr.ce.dsg.deus.example.revol.RevolBirthSchedulerListener" >
	 	<aut:events><!-- events to be scheduled on created node -->
		    <aut:reference id="connection2" />
		</aut:events>
	</aut:event>
	
	<aut:event id="connection" handler="it.unipr.ce.dsg.deus.p2p.event.ExpTopologyConnectionEvent" oneShot="true" 
	schedulerListener="it.unipr.ce.dsg.deus.example.revol.RevolExpTopologyConnectionSchedulerListener">
		<aut:params>
			<aut:param name="isBidirectional" value="true" />
			<aut:param name="n0" value="5" />
			<aut:param name="m" value="3" />
		</aut:params>
	</aut:event>
	
	<aut:event id="connection2" handler="it.unipr.ce.dsg.deus.p2p.event.ExpTopologyConnectionEvent" oneShot="true" 
	schedulerListener="it.unipr.ce.dsg.deus.example.revol.RevolExpTopologyConnectionSchedulerListener">
		<aut:params>
			<aut:param name="isBidirectional" value="true" />
			<aut:param name="n0" value="5" />
			<aut:param name="m" value="3" />
		</aut:params>
	</aut:event>
	
 	<aut:event id="discovery" handler="it.unipr.ce.dsg.deus.example.revol.RevolDiscoveryEvent" >
		<aut:logger level="INFO" />
		<aut:params>
			<aut:param name="hasSameAssociatedNode" value="false" />
			<aut:param name="cpu" value="2048" /><!-- MHz -->
			<aut:param name="ram" value="1024" /><!-- MB -->
			<aut:param name="disk" value="100000" /><!-- MB -->
			<aut:param name="meanArrivalTriggeredDiscovery" value="2" />
			<aut:param name="meanArrivalFreeResource" value="5000000" />
			<aut:param name="numInitialConnections" value="3" />
		</aut:params>
	</aut:event>
	
	<aut:event id="freeres" handler="it.unipr.ce.dsg.deus.example.revol.RevolFreeResourceEvent" >
		<aut:logger level="INFO" />
	</aut:event>
	
	<aut:event id="disconnection" handler="it.unipr.ce.dsg.deus.p2p.event.DisconnectionEvent"
	schedulerListener="it.unipr.ce.dsg.deus.example.revol.RevolDisconnectionSchedulerListener">
		<aut:events>
			<aut:reference id="death" />
		</aut:events>
	</aut:event>
	
	<aut:event id="death" handler="it.unipr.ce.dsg.deus.impl.event.DeathEvent" oneShot="true" />
	 
	<aut:event id="logPopulationSize" handler="it.unipr.ce.dsg.deus.impl.event.LogPopulationSizeEvent" />

	<aut:event id="logVirtualTime" handler="it.unipr.ce.dsg.deus.impl.event.LogVirtualTimeEvent" />
	
	<aut:event id="logNodeDegree" handler="it.unipr.ce.dsg.deus.p2p.event.LogNodeDegreeEvent" />
	
	<aut:event id="logRevolPeerStats" handler="it.unipr.ce.dsg.deus.example.revol.LogRevolPeerStatsEvent" />
	
	
	<!-- *** NODE SPECIES *** -->

	<aut:node id="revolNode" handler="it.unipr.ce.dsg.deus.example.revol.RevolPeer">
		<aut:params>
		    <aut:param name="fitnessFunction" value="1" />
			<aut:param name="maxInitChromosome" value="6" />
			<aut:param name="isRandomInit" value="true" />
		</aut:params>
		<aut:resources>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="cpuFactor" />
					<aut:param name="amount" value="4" /><!-- *512 MHz = 2GHz -->
				</aut:params>	
			</aut:resource>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="ramFactor" />
					<aut:param name="amount" value="4" /><!-- *256 MB = 1GB -->
				</aut:params>	
			</aut:resource>
			<aut:resource handler="it.unipr.ce.dsg.deus.impl.resource.AllocableResource">
				<aut:params>
					<aut:param name="type" value="diskFactor" />
					<aut:param name="amount" value="10" /><!-- *10000 MB = 100GB -->
				</aut:params>	
			</aut:resource>
		</aut:resources>
	</aut:node>


	<!-- *** PROCESSES *** -->

	<!-- with 1/lambda = 1000 and 1/lambda' = 1000000, we have E[N] = lambda/lambda' = 1000 -->

	<aut:process id="rectpulseperiodic" handler="it.unipr.ce.dsg.deus.impl.process.RectangularPulsePeriodicProcess">
		<aut:params>
			<aut:param name="period" value="10" />
			<aut:param name="startVtThreshold" value="0" />
			<aut:param name="stopVtThreshold" value="100000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="revolNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth" />
		</aut:events>
	</aut:process>

	<aut:process id="rectpulsepoisson" handler="it.unipr.ce.dsg.deus.impl.process.RectangularPulsePoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="1000" />
			<aut:param name="startVtThreshold" value="100000" />
			<aut:param name="stopVtThreshold" value="20000000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="revolNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="birth2" />
		</aut:events>
	</aut:process>

	<aut:process id="poisson2" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="5" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="revolNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="connection" />
			<aut:reference id="connection2" />
			<aut:reference id="death" />
		</aut:events>
	</aut:process>

	<aut:process id="poisson3" handler="it.unipr.ce.dsg.deus.impl.process.RectangularPulsePoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="1000" /> 
			<aut:param name="startVtThreshold" value="100000" />
			<aut:param name="stopVtThreshold" value="20000000" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="revolNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="disconnection" />
		</aut:events>
	</aut:process>

	<aut:process id="poisson4" handler="it.unipr.ce.dsg.deus.impl.process.PoissonProcess">
		<aut:params>
			<aut:param name="meanArrival" value="400" />
		</aut:params>
		<aut:nodes>
			<aut:reference id="revolNode" />
		</aut:nodes>
		<aut:events>
			<aut:reference id="discovery" />
		</aut:events>
	</aut:process>
	
	<aut:process id="periodic1" handler="it.unipr.ce.dsg.deus.impl.process.PeriodicProcess">
		<aut:params>
			<aut:param name="period" value="1000000" /> 
		</aut:params>
		<aut:events>
		    <aut:reference id="logPopulationSize" />
		    <aut:reference id="logVirtualTime" />
			<!-- aut:reference id="logNodeDegree" /--> 
			<aut:reference id="logRevolPeerStats" /> 
		</aut:events>
	</aut:process>


	<!-- *** SIMULATION *** -->

	<aut:engine maxvt="20000001" seed="123456789"> 
		<aut:logger level="INFO" />
		<aut:processes>
			<aut:reference id="rectpulseperiodic" />
			<aut:reference id="rectpulsepoisson" />
			<aut:reference id="poisson3" />
			<aut:reference id="poisson4" />
			<aut:reference id="periodic1" />
		</aut:processes>
	</aut:engine>

</aut:automator>
